<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Factorial Calculator</title>
    <style>
      :root {
        --primary-color: #4caf50;
        --primary-hover: #45a049;
        --success-bg: #d4edda;
        --success-color: #155724;
        --success-border: #c3e6cb;
        --error-bg: #f8d7da;
        --error-color: #721c24;
        --error-border: #f5c6cb;
        --border-radius: 8px;
        --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        --font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      * {
        box-sizing: border-box;
      }

      body {
        font-family: var(--font-family);
        max-width: 600px;
        margin: 2rem auto;
        padding: 1.25rem;
        background-color: #f5f5f5;
        line-height: 1.6;
      }
      .container {
        background-color: white;
        padding: 2rem;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
      }

      .calculator-form {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }
      .input-group {
        margin-bottom: 20px;
      }
      label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        color: #555;
      }
      input[type="number"] {
        padding: 0.75rem;
        border: 2px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
        transition: border-color 0.2s ease;
      }

      input[type="number"]:focus {
        outline: 2px solid var(--primary-color);
        outline-offset: 2px;
        border-color: var(--primary-color);
      }

      input[type="number"]:invalid {
        border-color: var(--error-color);
      }

      .btn {
        background-color: var(--primary-color);
        color: white;
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 500;
        transition: background-color 0.2s ease, transform 0.1s ease;
      }

      .btn:hover:not(:disabled) {
        background-color: var(--primary-hover);
        transform: translateY(-1px);
      }

      .btn:active {
        transform: translateY(0);
      }
      button:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
      }
      .result {
        margin-top: 20px;
        padding: 15px;
        border-radius: 4px;
        font-size: 18px;
        font-weight: bold;
        text-align: center;
      }
      .result.success {
        background-color: var(--success-bg);
        color: var(--success-color);
        border: 1px solid var(--success-border);
      }

      .result.error {
        background-color: var(--error-bg);
        color: var(--error-color);
        border: 1px solid var(--error-border);
      }

      .result.info {
        background-color: #cce5ff;
        color: #004085;
        border: 1px solid #99ccff;
      }

      .result {
        margin-top: 1.25rem;
        padding: 1rem;
        border-radius: 4px;
        font-size: 1.125rem;
        font-weight: 600;
        text-align: center;
        animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .hidden {
        display: none;
      }

      header {
        text-align: center;
        margin-bottom: 2rem;
      }

      header p {
        color: #666;
        margin-top: 0.5rem;
        font-size: 0.9rem;
      }

      .help-text {
        display: block;
        margin-top: 0.25rem;
        color: #666;
        font-size: 0.875rem;
      }

      .input-group {
        display: flex;
        flex-direction: column;
      }

      @media (max-width: 640px) {
        body {
          margin: 1rem;
          padding: 1rem;
        }

        .container {
          padding: 1.5rem;
        }
      }
    </style>
  </head>
  <body>
    <main class="container">
      <header>
        <h1>Factorial Calculator</h1>
        <p>Calculate the factorial of any non-negative integer up to 170</p>
      </header>

      <form class="calculator-form" novalidate>
        <div class="input-group">
          <label for="numberInput">Enter a number:</label>
          <input
            type="number"
            id="numberInput"
            name="number"
            min="0"
            max="170"
            step="1"
            placeholder="Enter a non-negative integer (0-170)"
            aria-describedby="numberHelp"
            required
          />
          <small id="numberHelp" class="help-text"
            >Enter an integer between 0 and 170</small
          >
        </div>

        <button type="submit" class="btn" aria-describedby="result">
          Calculate Factorial
        </button>
      </form>

      <div
        id="result"
        class="result hidden"
        role="status"
        aria-live="polite"
      ></div>
    </main>

    <!-- Include the factorial.js file -->
    <script src="factorial.js"></script>

    <script>
      /**
       * Factorial Calculator App
       * Handles user input validation and factorial calculation display
       */
      class FactorialCalculator {
        constructor() {
          this.form = document.querySelector(".calculator-form");
          this.input = document.getElementById("numberInput");
          this.resultDiv = document.getElementById("result");
          this.button = this.form.querySelector("button");

          this.init();
        }

        /**
         * Initialize event listeners
         */
        init() {
          // Form submission handler
          this.form.addEventListener("submit", (e) => {
            e.preventDefault();
            this.calculateFactorial();
          });

          // Input validation on typing
          this.input.addEventListener("input", () => {
            this.clearResult();
            this.validateInput();
          });

          // Real-time validation feedback
          this.input.addEventListener("blur", () => {
            this.validateInput();
          });
        }

        /**
         * Validates the input field and provides visual feedback
         */
        validateInput() {
          const value = this.input.value.trim();
          const isValid = this.isValidInput(value);

          this.input.setAttribute("aria-invalid", !isValid);
          this.button.disabled = !isValid && value !== "";
        }

        /**
         * Checks if the input is valid
         * @param {string} value - The input value to validate
         * @returns {boolean} True if valid, false otherwise
         */
        isValidInput(value) {
          if (value === "") return true; // Empty is acceptable

          const number = Number(value);
          return Number.isInteger(number) && number >= 0 && number <= 170;
        }

        /**
         * Main calculation function with comprehensive error handling
         */
        calculateFactorial() {
          const value = this.input.value.trim();

          this.clearResult();

          // Input validation
          const validationError = this.validateInputValue(value);
          if (validationError) {
            this.showResult(validationError, "error");
            this.input.focus();
            return;
          }

          const number = Number(value);

          try {
            // Show loading state for large numbers
            if (number > 20) {
              this.showResult("Calculating...", "info");
              // Use setTimeout to allow UI update
              setTimeout(() => this.performCalculation(number), 10);
            } else {
              this.performCalculation(number);
            }
          } catch (error) {
            this.showResult(`Calculation error: ${error.message}`, "error");
          }
        }

        /**
         * Performs the actual factorial calculation
         * @param {number} number - The number to calculate factorial for
         */
        performCalculation(number) {
          try {
            const result = factorial(number);
            const formattedResult = this.formatResult(result);
            this.showResult(`${number}! = ${formattedResult}`, "success");
          } catch (error) {
            this.showResult(`Error: ${error.message}`, "error");
          }
        }

        /**
         * Validates input value and returns error message if invalid
         * @param {string} value - The input value
         * @returns {string|null} Error message or null if valid
         */
        validateInputValue(value) {
          if (value === "") {
            return "Please enter a number.";
          }

          const number = Number(value);

          if (!Number.isFinite(number)) {
            return "Please enter a valid number.";
          }

          if (!Number.isInteger(number)) {
            return "Please enter a whole number (integer).";
          }

          if (number < 0) {
            return "Factorial is not defined for negative numbers.";
          }

          if (number > 170) {
            return "Number too large! Please enter a number between 0 and 170.";
          }

          return null;
        }

        /**
         * Formats large numbers with scientific notation if needed
         * @param {number} result - The factorial result
         * @returns {string} Formatted result string
         */
        formatResult(result) {
          if (result < 1e15) {
            return result.toLocaleString();
          }
          return result.toExponential(3);
        }

        /**
         * Displays result with specified type
         * @param {string} message - The message to display
         * @param {string} type - The type of message (success, error, info)
         */
        showResult(message, type) {
          this.resultDiv.textContent = message;
          this.resultDiv.className = `result ${type}`;
          this.resultDiv.scrollIntoView({
            behavior: "smooth",
            block: "nearest",
          });
        }

        /**
         * Clears the result display
         */
        clearResult() {
          this.resultDiv.className = "result hidden";
          this.resultDiv.textContent = "";
        }
      }

      // Initialize the calculator when DOM is loaded
      document.addEventListener("DOMContentLoaded", () => {
        new FactorialCalculator();
      });
    </script>
  </body>
</html>
